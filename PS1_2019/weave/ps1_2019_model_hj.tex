\documentclass[12pt,a4paper]{article}

\usepackage[a4paper,text={16.5cm,25.2cm},centering]{geometry}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{microtype}
\usepackage{hyperref}
\setlength{\parindent}{0pt}
\setlength{\parskip}{1.2ex}

\hypersetup
       {   pdfauthor = {  },
           pdftitle={  },
           colorlinks=TRUE,
           linkcolor=black,
           citecolor=blue,
           urlcolor=blue
       }




\usepackage{upquote}
\usepackage{listings}
\usepackage{xcolor}
\lstset{
    basicstyle=\ttfamily\footnotesize,
    upquote=true,
    breaklines=true,
    breakindent=0pt,
    keepspaces=true,
    showspaces=false,
    columns=fullflexible,
    showtabs=false,
    showstringspaces=false,
    escapeinside={(*@}{@*)},
    extendedchars=true,
}
\newcommand{\HLJLt}[1]{#1}
\newcommand{\HLJLw}[1]{#1}
\newcommand{\HLJLe}[1]{#1}
\newcommand{\HLJLeB}[1]{#1}
\newcommand{\HLJLo}[1]{#1}
\newcommand{\HLJLk}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkc}[1]{\textcolor[RGB]{59,151,46}{\textit{#1}}}
\newcommand{\HLJLkd}[1]{\textcolor[RGB]{214,102,97}{\textit{#1}}}
\newcommand{\HLJLkn}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkp}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkr}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLkt}[1]{\textcolor[RGB]{148,91,176}{\textbf{#1}}}
\newcommand{\HLJLn}[1]{#1}
\newcommand{\HLJLna}[1]{#1}
\newcommand{\HLJLnb}[1]{#1}
\newcommand{\HLJLnbp}[1]{#1}
\newcommand{\HLJLnc}[1]{#1}
\newcommand{\HLJLncB}[1]{#1}
\newcommand{\HLJLnd}[1]{\textcolor[RGB]{214,102,97}{#1}}
\newcommand{\HLJLne}[1]{#1}
\newcommand{\HLJLneB}[1]{#1}
\newcommand{\HLJLnf}[1]{\textcolor[RGB]{66,102,213}{#1}}
\newcommand{\HLJLnfm}[1]{\textcolor[RGB]{66,102,213}{#1}}
\newcommand{\HLJLnp}[1]{#1}
\newcommand{\HLJLnl}[1]{#1}
\newcommand{\HLJLnn}[1]{#1}
\newcommand{\HLJLno}[1]{#1}
\newcommand{\HLJLnt}[1]{#1}
\newcommand{\HLJLnv}[1]{#1}
\newcommand{\HLJLnvc}[1]{#1}
\newcommand{\HLJLnvg}[1]{#1}
\newcommand{\HLJLnvi}[1]{#1}
\newcommand{\HLJLnvm}[1]{#1}
\newcommand{\HLJLl}[1]{#1}
\newcommand{\HLJLld}[1]{\textcolor[RGB]{148,91,176}{\textit{#1}}}
\newcommand{\HLJLs}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsa}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsb}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsc}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsd}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsdB}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsdC}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLse}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLsh}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsi}[1]{#1}
\newcommand{\HLJLso}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLsr}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLss}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLssB}[1]{\textcolor[RGB]{201,61,57}{#1}}
\newcommand{\HLJLnB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnbB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnfB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnh}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLni}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnil}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLnoB}[1]{\textcolor[RGB]{59,151,46}{#1}}
\newcommand{\HLJLoB}[1]{\textcolor[RGB]{102,102,102}{\textbf{#1}}}
\newcommand{\HLJLow}[1]{\textcolor[RGB]{102,102,102}{\textbf{#1}}}
\newcommand{\HLJLp}[1]{#1}
\newcommand{\HLJLc}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLch}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcm}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcp}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcpB}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcs}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLcsB}[1]{\textcolor[RGB]{153,153,119}{\textit{#1}}}
\newcommand{\HLJLg}[1]{#1}
\newcommand{\HLJLgd}[1]{#1}
\newcommand{\HLJLge}[1]{#1}
\newcommand{\HLJLgeB}[1]{#1}
\newcommand{\HLJLgh}[1]{#1}
\newcommand{\HLJLgi}[1]{#1}
\newcommand{\HLJLgo}[1]{#1}
\newcommand{\HLJLgp}[1]{#1}
\newcommand{\HLJLgs}[1]{#1}
\newcommand{\HLJLgsB}[1]{#1}
\newcommand{\HLJLgt}[1]{#1}


\begin{document}



\begin{lstlisting}
(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{------------------------------------------------------------------------------}@*)
(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{Problem}@*) (*@\HLJLcs{Set}@*) (*@\HLJLcs{1}@*) (*@\HLJLcs{(2019):}@*) (*@\HLJLcs{The}@*) (*@\HLJLcs{Eaton-Korturm}@*) (*@\HLJLcs{(2002)}@*) (*@\HLJLcs{Economy}@*)
(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{Written}@*) (*@\HLJLcs{by}@*) (*@\HLJLcs{Heejin}@*) (*@\HLJLcs{Yoon}@*)
(*@\HLJLcs{{\#}}@*) (*@\HLJLcs{------------------------------------------------------------------------------}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{keyword-enabled}@*) (*@\HLJLcs{structure}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{hold}@*) (*@\HLJLcs{model}@*) (*@\HLJLcs{primitives}@*)

(*@\HLJLnd{@with{\_}kw}@*) (*@\HLJLk{struct}@*) (*@\HLJLn{Primitives}@*)
    (*@\HLJLn{nk}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Int64}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{100000}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{number}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{goods}@*)
    (*@\HLJLn{nc}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Int64}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{3}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{number}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{countries}@*)
    (*@\HLJLn{\ensuremath{\theta}}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Float64}@*) (*@\HLJLoB{=}@*) (*@\HLJLnfB{4.0}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{Frechet}@*) (*@\HLJLcs{parameter}@*)
    (*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Float64}@*) (*@\HLJLoB{=}@*) (*@\HLJLnfB{2.0}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{elasticity}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{substitution}@*)
    (*@\HLJLn{l}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{{\}}}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{ones}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{(inelastic)}@*) (*@\HLJLcs{labor}@*) (*@\HLJLcs{supply}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{structure}@*) (*@\HLJLcs{that}@*) (*@\HLJLcs{holds}@*) (*@\HLJLcs{model}@*) (*@\HLJLcs{results}@*)

(*@\HLJLk{mutable}@*) (*@\HLJLk{struct}@*) (*@\HLJLn{Results}@*)
    (*@\HLJLn{z}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{productivity}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*) (*@\HLJLcs{{\&}}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{good}@*) (*@\HLJLcs{(100,000}@*) (*@\HLJLcs{\ensuremath{\times}}@*) (*@\HLJLcs{3)}@*)
    (*@\HLJLn{w}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{wage}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*) (*@\HLJLcs{(1}@*) (*@\HLJLcs{\ensuremath{\times}}@*) (*@\HLJLcs{3)}@*)
    (*@\HLJLn{p}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{actual}@*) (*@\HLJLcs{price}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{good}@*) (*@\HLJLcs{imported}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*) (*@\HLJLcs{(100,000}@*) (*@\HLJLcs{\ensuremath{\times}}@*) (*@\HLJLcs{3)}@*)
    (*@\HLJLn{p{\_}index}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{CES}@*) (*@\HLJLcs{price}@*) (*@\HLJLcs{index}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*) (*@\HLJLcs{(3}@*) (*@\HLJLcs{\ensuremath{\times}}@*) (*@\HLJLcs{1)}@*)
    (*@\HLJLn{supplier}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Int64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{supplier}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{good}@*) (*@\HLJLcs{imported}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*) (*@\HLJLcs{(100,000}@*) (*@\HLJLcs{\ensuremath{\times}}@*) (*@\HLJLcs{3)}@*)
    (*@\HLJLn{X}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{bilateral}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flow}@*)
    (*@\HLJLn{EX}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{excess}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flow:}@*) (*@\HLJLcs{export}@*) (*@\HLJLcs{flow}@*) (*@\HLJLcs{-}@*) (*@\HLJLcs{import}@*) (*@\HLJLcs{flow}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*)
    (*@\HLJLn{\ensuremath{\Pi}}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}}}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{bilateral}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{share}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{function}@*) (*@\HLJLcs{for}@*) (*@\HLJLcs{initializing}@*) (*@\HLJLcs{model}@*) (*@\HLJLcs{primitives}@*) (*@\HLJLcs{and}@*) (*@\HLJLcs{results}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{Initialize}@*)(*@\HLJLp{()}@*)
    (*@\HLJLn{prim}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{Primitives}@*)(*@\HLJLp{()}@*)
    (*@\HLJLn{z}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{w}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{ones}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLp{,}@*) (*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{p}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{p{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{supplier}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{X}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{EX}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{\ensuremath{\Pi}}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{res}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{Results}@*)(*@\HLJLp{(}@*)(*@\HLJLn{z}@*)(*@\HLJLp{,}@*) (*@\HLJLn{w}@*)(*@\HLJLp{,}@*) (*@\HLJLn{p}@*)(*@\HLJLp{,}@*) (*@\HLJLn{p{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{supplier}@*)(*@\HLJLp{,}@*) (*@\HLJLn{X}@*)(*@\HLJLp{,}@*) (*@\HLJLn{EX}@*)(*@\HLJLp{,}@*) (*@\HLJLn{\ensuremath{\Pi}}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{prim}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{draw}@*) (*@\HLJLcs{productivity}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{draw{\_}productivity}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Primitives}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Results}@*)(*@\HLJLp{,}@*) (*@\HLJLn{T}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{{\}})}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLn{\ensuremath{\theta}}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{prim}@*)

    (*@\HLJLn{Random}@*)(*@\HLJLoB{.}@*)(*@\HLJLnf{seed!}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1234}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{z}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{b}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{T}@*)(*@\HLJLoB{.{\textasciicircum}}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{\ensuremath{\theta}}@*)(*@\HLJLp{)}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{command}@*) (*@\HLJLcs{Frechet(a,}@*) (*@\HLJLcs{b)}@*) (*@\HLJLcs{in}@*) (*@\HLJLcs{Julia}@*) (*@\HLJLcs{gives}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{distribution}@*) (*@\HLJLcs{exp(-(x/b){\textasciicircum}(-a))}@*) (*@\HLJLcs{\ensuremath{\Rightarrow}}@*) (*@\HLJLcs{a}@*) (*@\HLJLcs{=}@*) (*@\HLJLcs{\ensuremath{\theta},}@*) (*@\HLJLcs{b}@*) (*@\HLJLcs{=}@*) (*@\HLJLcs{(T\ensuremath{\_i}){\textasciicircum}(1/\ensuremath{\theta})}@*)

    (*@\HLJLk{for}@*) (*@\HLJLn{c{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)  (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{country}@*) (*@\HLJLcs{index}@*) (*@\HLJLcs{from}@*) (*@\HLJLcs{1}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{3}@*)
        (*@\HLJLn{dist}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{Frechet}@*)(*@\HLJLp{(}@*)(*@\HLJLn{\ensuremath{\theta}}@*)(*@\HLJLp{,}@*) (*@\HLJLn{b}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{])}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{k{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nk}@*)
            (*@\HLJLn{z}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{rand}@*)(*@\HLJLp{(}@*)(*@\HLJLn{dist}@*)(*@\HLJLp{)}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLn{z}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{price}@*) (*@\HLJLcs{and}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{supplier}@*) (*@\HLJLcs{country}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{product}@*) (*@\HLJLcs{imported}@*) (*@\HLJLcs{by}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country.}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{price{\_}supplier}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Primitives}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Results}@*)(*@\HLJLp{,}@*) (*@\HLJLn{\ensuremath{\tau}}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}})}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{prim}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{w}@*)(*@\HLJLp{,}@*) (*@\HLJLn{z}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{res}@*)

    (*@\HLJLn{latent{\_}p}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{p}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{supplier}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{Int64}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{prices}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{goods}@*) (*@\HLJLcs{offered}@*) (*@\HLJLcs{by}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{j{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{i{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
            (*@\HLJLk{for}@*) (*@\HLJLn{k{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nk}@*)
                (*@\HLJLn{latent{\_}p}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{w}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{z}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{i{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{*}@*) (*@\HLJLp{(}@*)(*@\HLJLni{1}@*) (*@\HLJLoB{+}@*) (*@\HLJLn{\ensuremath{\tau}}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{])}@*)
            (*@\HLJLk{end}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{for}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{importing}@*) (*@\HLJLcs{country,}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{minimum}@*) (*@\HLJLcs{price}@*) (*@\HLJLcs{offer}@*) (*@\HLJLcs{will}@*) (*@\HLJLcs{be}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{actual}@*) (*@\HLJLcs{price.}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{j{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{k{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nk}@*)
            (*@\HLJLn{p}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{minimum}@*)(*@\HLJLp{(}@*)(*@\HLJLn{latent{\_}p}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLoB{:}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{])}@*)
            (*@\HLJLn{supplier}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{argmin}@*)(*@\HLJLp{(}@*)(*@\HLJLn{latent{\_}p}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLoB{:}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{])}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{price}@*) (*@\HLJLcs{index}@*) (*@\HLJLcs{using}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{actual}@*) (*@\HLJLcs{price.}@*)
    (*@\HLJLn{p{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{c{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLn{p{\_}index}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{(}@*)(*@\HLJLnf{sum}@*)(*@\HLJLp{(}@*)(*@\HLJLn{p}@*)(*@\HLJLp{[}@*)(*@\HLJLoB{:}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{.{\textasciicircum}}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLoB{-}@*)(*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{)))}@*)(*@\HLJLoB{{\textasciicircum}}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLoB{/}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLoB{-}@*)(*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{))}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLn{p}@*)(*@\HLJLp{,}@*) (*@\HLJLn{p{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{supplier}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{bilateral}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flows}@*) (*@\HLJLcs{and}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{excess}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flow.}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{trade{\_}flow}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Primitives}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Results}@*)(*@\HLJLp{)}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLn{l}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{prim}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{w}@*)(*@\HLJLp{,}@*) (*@\HLJLn{p}@*)(*@\HLJLp{,}@*) (*@\HLJLn{p{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{supplier}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{res}@*)

    (*@\HLJLn{c}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{expenditure}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{X}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{EX}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{demand}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{importing}@*) (*@\HLJLcs{countries}@*) (*@\HLJLcs{for}@*) (*@\HLJLcs{k}@*) (*@\HLJLcs{goods,}@*) (*@\HLJLcs{and}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{total}@*) (*@\HLJLcs{importing}@*) (*@\HLJLcs{value.}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{c{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{k{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nk}@*)
            (*@\HLJLn{c}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{(}@*)(*@\HLJLn{p}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{p{\_}index}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{])}@*)(*@\HLJLoB{{\textasciicircum}}@*)(*@\HLJLp{(}@*)(*@\HLJLoB{-}@*)(*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{)}@*) (*@\HLJLoB{*}@*) (*@\HLJLp{((}@*)(*@\HLJLn{w}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{*}@*)(*@\HLJLn{l}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{])}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{p{\_}index}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{])}@*)
            (*@\HLJLn{expenditure}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{c}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{*}@*) (*@\HLJLn{p}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{bilateral}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flows.}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{j{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{i{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
            (*@\HLJLk{for}@*) (*@\HLJLn{k{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nk}@*)
                (*@\HLJLk{if}@*) (*@\HLJLn{supplier}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{==}@*) (*@\HLJLn{i{\_}index}@*)
                    (*@\HLJLn{X}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{+=}@*) (*@\HLJLn{expenditure}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*)
                (*@\HLJLk{end}@*)
            (*@\HLJLk{end}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{excess}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flow}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{each}@*) (*@\HLJLcs{country.}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{i{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLn{EX}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{sum}@*)(*@\HLJLp{(}@*)(*@\HLJLn{X}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLoB{:}@*)(*@\HLJLp{])}@*) (*@\HLJLoB{-}@*) (*@\HLJLnf{sum}@*)(*@\HLJLp{(}@*)(*@\HLJLn{X}@*)(*@\HLJLp{[}@*)(*@\HLJLoB{:}@*)(*@\HLJLp{,}@*) (*@\HLJLn{i{\_}index}@*)(*@\HLJLp{])}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLn{X}@*)(*@\HLJLp{,}@*) (*@\HLJLn{EX}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{define}@*) (*@\HLJLcs{find{\_}wage}@*) (*@\HLJLcs{function}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{minimize}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{excess}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flow}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{find{\_}wage}@*)(*@\HLJLp{(}@*)(*@\HLJLn{ww}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{w}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{1.0}@*) (*@\HLJLn{ww}@*)(*@\HLJLp{]}@*)
    (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{p}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{p{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{supplier}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{price{\_}supplier}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLp{,}@*) (*@\HLJLn{\ensuremath{\tau}}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{X}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{EX}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{trade{\_}flow}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{err}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{sum}@*)(*@\HLJLp{(}@*)(*@\HLJLn{abs}@*)(*@\HLJLoB{.}@*)(*@\HLJLp{(}@*)(*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{EX}@*)(*@\HLJLp{))}@*)

    (*@\HLJLn{err}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{solve}@*) (*@\HLJLcs{for}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{balanced}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{condition}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{solve{\_}balanced{\_}trade}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Primitives}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Results}@*)(*@\HLJLp{,}@*) (*@\HLJLn{\ensuremath{\tau}}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}})}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{nc}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{prim}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{find}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{wage}@*) (*@\HLJLcs{levels}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{countries}@*) (*@\HLJLcs{2}@*) (*@\HLJLcs{and}@*) (*@\HLJLcs{3,}@*) (*@\HLJLcs{which}@*) (*@\HLJLcs{minimizes}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{sum}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{excess}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flow}@*) (*@\HLJLcs{of}@*) (*@\HLJLcs{three}@*) (*@\HLJLcs{countries.}@*)
    (*@\HLJLn{w{\_}1}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{optimize}@*)(*@\HLJLp{(}@*)(*@\HLJLn{find{\_}wage}@*)(*@\HLJLp{,}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{1.0}@*) (*@\HLJLnfB{1.0}@*)(*@\HLJLp{],}@*) (*@\HLJLnf{NelderMead}@*)(*@\HLJLp{())}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{minimizer}@*)
    (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{w}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{[}@*)(*@\HLJLnfB{1.0}@*) (*@\HLJLn{w{\_}1}@*)(*@\HLJLp{]}@*)

    (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flow}@*) (*@\HLJLcs{share}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{i{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{j{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
            (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{\ensuremath{\Pi}}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{X}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{/}@*) (*@\HLJLp{(}@*)(*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{w}@*)(*@\HLJLp{[}@*)(*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{*}@*) (*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{l}@*)(*@\HLJLp{[}@*)(*@\HLJLn{j{\_}index}@*)(*@\HLJLp{])}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{welfare}@*) (*@\HLJLcs{gain}@*) (*@\HLJLcs{obtained}@*) (*@\HLJLcs{by}@*) (*@\HLJLcs{moving}@*) (*@\HLJLcs{from}@*) (*@\HLJLcs{autarky}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{welfare{\_}gain}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Primitives}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Results}@*)(*@\HLJLp{)}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{prim}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{z}@*)(*@\HLJLp{,}@*) (*@\HLJLn{w}@*)(*@\HLJLp{,}@*) (*@\HLJLn{p{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{res}@*)

    (*@\HLJLn{w{\_}autarky}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{ones}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLni{1}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{latent{\_}p{\_}autarky}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nk}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLn{p{\_}index{\_}autarky}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{,}@*) (*@\HLJLni{1}@*)(*@\HLJLp{)}@*)

    (*@\HLJLk{for}@*) (*@\HLJLn{j{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{i{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
            (*@\HLJLk{for}@*) (*@\HLJLn{k{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nk}@*)
                (*@\HLJLn{latent{\_}p{\_}autarky}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{w{\_}autarky}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{z}@*)(*@\HLJLp{[}@*)(*@\HLJLn{k{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{i{\_}index}@*)(*@\HLJLp{]}@*)
            (*@\HLJLk{end}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLk{for}@*) (*@\HLJLn{c{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLn{p{\_}index{\_}autarky}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{(}@*)(*@\HLJLnf{sum}@*)(*@\HLJLp{(}@*)(*@\HLJLn{latent{\_}p{\_}autarky}@*)(*@\HLJLp{[}@*)(*@\HLJLoB{:}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{.{\textasciicircum}}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLoB{-}@*)(*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{)))}@*)(*@\HLJLoB{{\textasciicircum}}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLoB{/}@*)(*@\HLJLp{(}@*)(*@\HLJLni{1}@*)(*@\HLJLoB{-}@*)(*@\HLJLn{\ensuremath{\sigma}}@*)(*@\HLJLp{))}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLn{wg}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{zeros}@*)(*@\HLJLp{(}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{)}@*)
    (*@\HLJLk{for}@*) (*@\HLJLn{c{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLn{wg}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLp{(}@*)(*@\HLJLn{w}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{p{\_}index}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{])}@*)(*@\HLJLoB{/}@*)(*@\HLJLp{(}@*)(*@\HLJLn{w{\_}autarky}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{p{\_}index{\_}autarky}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{])}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLn{wg}@*)
(*@\HLJLk{end}@*)

(*@\HLJLcs{{\#}{\#}}@*) (*@\HLJLcs{alternative}@*) (*@\HLJLcs{way}@*) (*@\HLJLcs{to}@*) (*@\HLJLcs{calculate}@*) (*@\HLJLcs{the}@*) (*@\HLJLcs{balanced}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{condition:}@*) (*@\HLJLcs{adjust}@*) (*@\HLJLcs{w\ensuremath{\_2}}@*) (*@\HLJLcs{and}@*) (*@\HLJLcs{w\ensuremath{\_3}}@*) (*@\HLJLcs{little}@*) (*@\HLJLcs{by}@*) (*@\HLJLcs{little}@*)

(*@\HLJLk{function}@*) (*@\HLJLnf{solve{\_}balanced{\_}trade{\_}alt}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Primitives}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{::}@*)(*@\HLJLn{Results}@*)(*@\HLJLp{,}@*) (*@\HLJLn{\ensuremath{\tau}}@*)(*@\HLJLoB{::}@*)(*@\HLJLnf{Array}@*)(*@\HLJLp{{\{}}@*)(*@\HLJLn{Float64}@*)(*@\HLJLp{,}@*) (*@\HLJLni{2}@*)(*@\HLJLp{{\}})}@*)
    (*@\HLJLnd{@unpack}@*) (*@\HLJLn{nc}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{prim}@*)
    (*@\HLJLn{tol}@*) (*@\HLJLoB{=}@*) (*@\HLJLnfB{0.0001}@*)
    (*@\HLJLn{err}@*) (*@\HLJLoB{=}@*) (*@\HLJLnfB{1.0}@*)
    (*@\HLJLn{n}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*) (*@\HLJLcs{{\#}}@*) (*@\HLJLcs{count}@*)

    (*@\HLJLk{while}@*) (*@\HLJLkc{true}@*)
        (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{p}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{p{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{supplier}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{price{\_}supplier}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLp{,}@*) (*@\HLJLn{\ensuremath{\tau}}@*)(*@\HLJLp{)}@*)
        (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{X}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{EX}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{trade{\_}flow}@*)(*@\HLJLp{(}@*)(*@\HLJLn{prim}@*)(*@\HLJLp{,}@*) (*@\HLJLn{res}@*)(*@\HLJLp{)}@*) (*@\HLJLcs{{\#}spit}@*) (*@\HLJLcs{out}@*) (*@\HLJLcs{excess}@*) (*@\HLJLcs{trade}@*) (*@\HLJLcs{flows}@*)
        (*@\HLJLn{err}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{maximum}@*)(*@\HLJLp{(}@*)(*@\HLJLn{abs}@*)(*@\HLJLoB{.}@*)(*@\HLJLp{(}@*)(*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{EX}@*)(*@\HLJLp{[}@*)(*@\HLJLni{2}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{]))}@*) (*@\HLJLcs{{\#}reset}@*) (*@\HLJLcs{error}@*) (*@\HLJLcs{level}@*)
        (*@\HLJLn{c{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLnf{argmax}@*)(*@\HLJLp{(}@*)(*@\HLJLn{abs}@*)(*@\HLJLoB{.}@*)(*@\HLJLp{(}@*)(*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{EX}@*)(*@\HLJLp{[}@*)(*@\HLJLni{2}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)(*@\HLJLp{]))}@*) (*@\HLJLoB{+}@*) (*@\HLJLni{1}@*)
        (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{w}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{w}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{+}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{EX}@*)(*@\HLJLp{[}@*)(*@\HLJLn{c{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{*}@*) (*@\HLJLnfB{0.1}@*)

        (*@\HLJLnf{println}@*)(*@\HLJLp{(}@*)(*@\HLJLs{"{}*****}@*) (*@\HLJLs{"{}}@*)(*@\HLJLp{,}@*) (*@\HLJLn{n}@*)(*@\HLJLp{,}@*) (*@\HLJLs{"{}th}@*) (*@\HLJLs{iteration}@*) (*@\HLJLs{*****"{}}@*)(*@\HLJLp{)}@*)
        (*@\HLJLnf{println}@*)(*@\HLJLp{(}@*)(*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{EX}@*)(*@\HLJLp{)}@*)
        (*@\HLJLnd{@printf}@*)(*@\HLJLp{(}@*)(*@\HLJLs{"{}Excess}@*) (*@\HLJLs{Trade}@*) (*@\HLJLs{Balance:}@*) (*@\HLJLs{{\%}0.5f}@*) (*@\HLJLse{{\textbackslash}n}@*)(*@\HLJLs{"{}}@*)(*@\HLJLp{,}@*) (*@\HLJLnf{float}@*)(*@\HLJLp{(}@*)(*@\HLJLn{err}@*)(*@\HLJLp{))}@*)
        (*@\HLJLnf{println}@*)(*@\HLJLp{(}@*)(*@\HLJLs{"{}***************************"{}}@*)(*@\HLJLp{)}@*)
        (*@\HLJLn{n}@*) (*@\HLJLoB{+=}@*) (*@\HLJLni{1}@*)
        (*@\HLJLk{if}@*) (*@\HLJLn{err}@*) (*@\HLJLoB{<}@*) (*@\HLJLn{tol}@*) (*@\HLJLcs{{\#}begin}@*) (*@\HLJLcs{iteration}@*)
            (*@\HLJLk{break}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)

    (*@\HLJLk{for}@*) (*@\HLJLn{i{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
        (*@\HLJLk{for}@*) (*@\HLJLn{j{\_}index}@*) (*@\HLJLoB{=}@*) (*@\HLJLni{1}@*)(*@\HLJLoB{:}@*)(*@\HLJLn{nc}@*)
            (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{\ensuremath{\Pi}}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*) (*@\HLJLoB{=}@*) (*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{X}@*)(*@\HLJLp{[}@*)(*@\HLJLn{i{\_}index}@*)(*@\HLJLp{,}@*) (*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{/}@*)(*@\HLJLn{res}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{w}@*)(*@\HLJLp{[}@*)(*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*)(*@\HLJLoB{*}@*)(*@\HLJLn{prim}@*)(*@\HLJLoB{.}@*)(*@\HLJLn{l}@*)(*@\HLJLp{[}@*)(*@\HLJLn{j{\_}index}@*)(*@\HLJLp{]}@*)
        (*@\HLJLk{end}@*)
    (*@\HLJLk{end}@*)
    (*@\HLJLnf{println}@*)(*@\HLJLp{(}@*)(*@\HLJLs{"{}Trade}@*) (*@\HLJLs{is}@*) (*@\HLJLs{balanced}@*) (*@\HLJLs{after}@*) (*@\HLJLs{"{}}@*)(*@\HLJLp{,}@*) (*@\HLJLn{n}@*)(*@\HLJLp{,}@*) (*@\HLJLs{"{}}@*) (*@\HLJLs{iterations.}@*)(*@\HLJLse{{\textbackslash}n}@*)(*@\HLJLs{"{}}@*)(*@\HLJLp{)}@*)

(*@\HLJLk{end}@*)
\end{lstlisting}

\begin{lstlisting}
Error: LoadError: UndefVarError: @with(*@{{\_}}@*)kw not defined
in expression starting at C:(*@{{\textbackslash}}@*)Users(*@{{\textbackslash}}@*)hyoon76(*@{{\textbackslash}}@*)OneDrive - UW-Madison(*@{{\textbackslash}}@*)3.Wisconsi
n(*@{{\textbackslash}}@*)2022 Fall(*@{{\textbackslash}}@*)Econ871(*@{{\textbackslash}}@*)Problem Sets(*@{{\textbackslash}}@*)PS1(*@{{\_}}@*)2019(*@{{\textbackslash}}@*)ps1(*@{{\_}}@*)2019(*@{{\_}}@*)model(*@{{\_}}@*)hj.jl:9
\end{lstlisting}



\end{document}
